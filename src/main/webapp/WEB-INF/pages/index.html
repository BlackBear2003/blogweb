
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Home</title>
    <script type="text/javascript"> (function() { var css = document.createElement('link'); css.href = 'https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'; css.rel = 'stylesheet'; css.type = 'text/css'; document.getElementsByTagName('head')[0].appendChild(css); })(); </script>
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="stylesheet" href="assets/css/theme.css">
    <script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js">
    </script>
</head>

<body>

<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top">
    <a id="logo" class="navbar-brand font-weight-bolder mr-3"><img src="assets/img/Blue_Discus.png"></a>
    <button class="navbar-light navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsDefault"
            aria-controls="navbarsDefault" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarsDefault">
        <ul class="navbar-nav mr-auto align-items-center">
            <form class="bd-search hidden-sm-down"></form>
                <input type="text" class="form-control bg-graylight border-0 font-weight-bold" id="search-input"
                                                         placeholder="搜索..." autocomplete="off">
                <div class="dropdown-menu bd-search-results" id="search-results">
                </div>



        </ul>

        <ul class="navbar-nav ml-auto align-items-center">
            <li class="nav-item">
                <a id="toHome" class="nav-link active">主页</a>
            </li>
            <li class="nav-item">
                <a type="button" class="nav-link" data-toggle="modal" data-target="#postModal">发表</a>
            </li>
            <li class="nav-item">

                <a id="toProfile" class="nav-link" ><img id="userImg" class="rounded-circle mr-2" src="assets/img/av.png"
                                                             width="30"><span class="align-middle">个人主页</span></a>
                <!--上面是头像-->
            </li>
            <li class="nav-item dropdown">
                <a class="nav-link" href="#" id="dropdown02" data-toggle="dropdown" aria-haspopup="true"
                   aria-expanded="false">
                    <svg style="margin-top:10px;" class="_3DJPT" version="1.1" viewbox="0 0 32 32" width="21"
                         height="21" aria-hidden="false" data-reactid="71">
                        <path d="M7 15.5c0 1.9-1.6 3.5-3.5 3.5s-3.5-1.6-3.5-3.5 1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5zm21.5-3.5c-1.9 0-3.5 1.6-3.5 3.5s1.6 3.5 3.5 3.5 3.5-1.6 3.5-3.5-1.6-3.5-3.5-3.5zm-12.5 0c-1.9 0-3.5 1.6-3.5 3.5s1.6 3.5 3.5 3.5 3.5-1.6 3.5-3.5-1.6-3.5-3.5-3.5z"
                              data-reactid="22"></path>
                    </svg>
                </a>
                <div class="dropdown-menu dropdown-menu-right shadow-lg" aria-labelledby="dropdown02">
                    <h4 class="dropdown-header display-4">分享我的源代码!<br/> Zhile·Wei from FZU</h4>
                    <div class="dropdown-divider">
                    </div>
                    <span class="dropdown-item"><a href="https://github.com/BlackBear2003/blogweb" class="btn btn-cyan d-block"><i
                            class="fa fa-download"></i> Download</a></span><!--把我的github仓库放进去-->
                </div>
            </li>
        </ul>
    </div>
</nav>
<div class="modal fade" id="postModal">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <!-- 模态框头部 -->
            <div class="modal-header">
                    <div class="input-group-prepend">
                        <button id="selectCate" type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
                            选择分类
                        </button>
                        <div class="dropdown-menu">
                            <div class = "d-flex flex-column">
                                <input id="category1" class="nav-link" type="button" value="风景">
                                <input id="category2" class="nav-link" type="button" value="美食">
                                <input id="category3" class="nav-link" type="button" value="游戏">
                                <input id="category4" class="nav-link" type="button" value="旅行">
                                <input id="category5" class="nav-link" type="button" value="居家">
                                <input id="category6" class="nav-link" type="button" value="娱乐">
                                <input id="category7" class="nav-link" type="button" value="书画">
                            </div>
                        </div>
                    </div>
            </div>

            <!-- 模态框主体 -->
            <div class="modal-body">
                <input type="text" class="form-control bg-gaslight border-0 font-weight-bold mb-2 mr-2" id="title-input"
                       placeholder="输入标题" autocomplete="off">
                <input type="text" class="form-control bg-gaslight border-0 font-weight-bold mb-2 mr-2" id="text-input"
                       placeholder="输入正文" autocomplete="off">
                <input id="img_input" type="file" accept="image/*"/>
                <label for="img_input" id="img_label">选择一张图片
                    <i class="fa fa-plus fa-lg"></i>
                </label>
                <div class="preview_box"></div>

            </div>

            <!-- 模态框底部 -->
            <div class="modal-footer">
                <div id="postConfirm" class="m-auto">
                    <button class="btn btn-primary" type="button" value="发表">发表<i class="fa fa-check"></i></button>
                </div>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭

                </button>
            </div>

        </div>
    </div>
</div>
<main role="main">


    <section class="mt-4 mb-5">
        <div class="container mb-4">
            <h5 id="hellotitle" class="font-weight-bold title">你好！</h5>
            <h1 class="font-weight-bold title">分享一个瞬间！</h1>
            <div class="row">
                <nav class="navbar navbar-expand-lg navbar-light bg-white pl-2 pr-2">
                    <button class="navbar-light navbar-toggler" type="button" data-toggle="collapse"
                            data-target="#navbarsExplore" aria-controls="navbarsDefault" aria-expanded="false"
                            aria-label="Toggle navigation">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <div class="collapse navbar-collapse" id="navbarsExplore">
                        <ul class="navbar-nav">
                            <li class="nav-item">
                                <a id="1" class="nav-link" >风景</a>
                            </li>
                            <li class="nav-item">
                                <a id="2" class="nav-link" >美食</a>
                            </li>
                            <li class="nav-item">
                                <a id="3" class="nav-link" >游戏</a>
                            </li>
                            <li class="nav-item">
                                <a id="4" class="nav-link" >旅行</a>
                            </li>
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" id="dropdown01"
                                   data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">更多</a>
                                <div class="dropdown-menu shadow-lg" aria-labelledby="dropdown01">
                                    <a id="5" class="dropdown-item" >居家</a>
                                    <a id="6" class="dropdown-item" >娱乐</a>
                                    <a id="7" class="dropdown-item" >书画</a>
                                    <a class="dropdown-item">待完善...</a>
                                </div>
                            </li>
                        </ul>
                    </div>
                </nav>
            </div>
        </div>
        <div class="container-fluid">
            <div class="row">
                <div class="card-columns">

                    <div class="card card-pin" id="card0">
                        <img class="card-img" src="" alt="Card image">
                        <div  class="overlay">
                            <h2 class="card-title title"> 模板</h2>
                            <div class="more">
                                <a id="postClick" href="">
                                    <i class="fa fa-arrow-circle-o-right" ></i> 查看 </a>
                            </div>
                        </div>
                    </div>


                </div>
            </div>
        </div>
    </section>

</main>

<script src="assets/js/app.js"></script>
<script src="assets/js/theme.js"></script>

<script>
    $("#card0").hide();
    $(document).ready(function () {

        //test Session
        const loginId=sessionStorage.getItem("loginID");
        console.log("session has loginID = "+loginId)

        //完成登陆后主界面个人信息的展示
        console.log(loginId);
        if (loginId) {
            $.get("http://localhost:8090/blogweb_war/user/info?id=" + loginId, function (data) {
                $("#hellotitle").text(data.name + ",你好！");
                $("#userImg").attr("src", "http://localhost:88/upload/" + data.img);
            })
        }

        //打开个人信息时传输id（已登录状态）
        $("#toProfile").click(function () {
            if (loginId) {
                window.location.href = "profile.html?id=" + loginId;
            } else {
                window.location.href = "profile.html"
            }
        })
        $("#toHome").click(function () {
            if (loginId) {
                window.location.href = "index.html?id=" + loginId;
            } else {
                window.location.href = "index.html"
            }
        })
        //类似刷新
        $("#logo").click(function () {
            if (loginId) {
                window.location.href = "index.html?id=" + loginId;
            } else {
                window.location.href = "index.html"
            }
        })
        //发表帖子功能
        //检测是否支持File API
        if (window.File && window.FileReader && window.FileList && window.Blob) {
            //  支持
        } else {
            alert('不支持File API');
        }
        $("#img_input").on("change", function (e) {

            var file = e.target.files[0]; //获取图片资源

            // 只选择图片文件
            if (!file.type.match('image.*')) {
                return false;
            }

            var reader = new FileReader();

            reader.readAsDataURL(file); // 读取文件
            // 渲染文件
            reader.onload = function (arg) {
                var img = '<img class="preview" src="' + arg.target.result + '" alt="preview"/>';
                $(".preview_box").empty().append(img);
            }
        });
        let postCate = 0;
        $("#category1").click(function () {
            $("#selectCate").text($("#category1").val());
            postCate = 1;
        })
        $("#category2").click(function () {
            $("#selectCate").text($("#category2").val());
            postCate = 2;

        })
        $("#category3").click(function () {
            $("#selectCate").text($("#category3").val());
            postCate = 3;
        })
        $("#category4").click(function () {
            $("#selectCate").text($("#category4").val());
            postCate = 4;
        })
        $("#category5").click(function () {
            $("#selectCate").text($("#category5").val());
            postCate = 5;
        })
        $("#category6").click(function () {
            $("#selectCate").text($("#category6").val());
            postCate = 6;
        })
        $("#category7").click(function () {
            $("#selectCate").text($("#category7").val());
            postCate = 7;
        })


        $("#postConfirm").click(function () {
            var form_data = new FormData();
            var file_data = $("#img_input").prop("files")[0];
            let title = $("#title-input").val();
            let text = $("#text-input").val();
            console.log(title);
            console.log(text);
            form_data.append("file", file_data);
            console.log(file_data);
            $.ajax({
                type: 'post',
                url: "http://localhost:8090/blogweb_war/fileUpload",
                data: form_data,
                cache: false,
                processData: false,
                contentType: false,
            }).success(function (imgName) {
                alert(imgName);
                console.log(imgName)

                $.post("http://localhost:8090/blogweb_war/post/",
                    {
                        title: title,
                        img: imgName,
                        text: text
                    }, function (data) {

                        console.log(data);
                        $.post("http://localhost:8090/blogweb_war/post/setAuthor",
                            {
                                u_id: loginId,
                                p_id: data
                            }, function (status) {
                                alert("setAuthor:" + status);
                            }
                        )
                        console.log(postCate)
                        $.post("http://localhost:8090/blogweb_war/post/setCategory",
                            {
                                c_id: postCate,
                                p_id: data
                            }, function (status) {
                                alert("setCategory:" + status);
                                location.reload()
                            }
                        )

                    })


                alert("发表成功！");

            })
        }).error(function () {
            alert("上传失败");
        });


        //搜索功能
        $("body").keydown(function(event) {
            // keyCode=13是回车键
            if ((event.keyCode == "13"||event.keyCode == "66")&&$("input[type=text]").val()!="") {
                // 触发 登录按钮被点击的事件
                let searchtitle=$("input[type=text]").val();
                console.log(searchtitle);
                let left = $(".card").length-1;
                while(left>0){
                    $("#card"+left).remove();
                    left--;
                }
                let test = $.getJSON('http://localhost:8090/blogweb_war/post/search',
                    {
                        title: searchtitle
                    }).done(function (data) {
                    // data已经被解析为JSON对象了

                    console.log(data);
                    let val1 = data.length;
                    console.log(val1);
                    let t = 1;
                    while (t <= val1) {
                        $("#card0").clone().attr("id", "card" + data[t - 1].id).appendTo(".card-columns").show();
                        $("#card" + data[t - 1].id).children("img").attr("src", "http://localhost:88/upload/" + data[t - 1].img);
                        $("#card" + data[t - 1].id).children("div").children("h2").text(data[t - 1].title);
                        $("#card" + data[t - 1].id).children("div").children("div").children("a").attr("href","post.html?p_id="+data[t - 1].id);
                        t += 1;
                    }
                });
            }
        });



        //查看卡片（帖子）详细信息功能



        //分类功能
        $("#7").click(function (  ) {
            let left = $(".card").length-1;
            while(left>0){
                $("#card"+left).remove();
                left--;
            }
            let stat = $.getJSON('http://localhost:8090/blogweb_war/post/getByCategory',
                {
                    c_id: "7"
                }).done(function (data) {
                // data已经被解析为JSON对象了

                console.log(data);
                let val1 = data.length;
                console.log(val1);
                let t = 1;
                while (t <= val1) {
                    $("#card0").clone().attr("id", "card" + data[t - 1].id).appendTo(".card-columns").show();
                    $("#card" + data[t - 1].id).children("img").attr("src", "http://localhost:88/upload/" + data[t - 1].img);
                    $("#card" + data[t - 1].id).children("div").children("h2").text(data[t - 1].title);
                    $("#card" + data[t - 1].id).children("div").children("div").children("a").attr("href","post.html?p_id="+data[t - 1].id);
                    t += 1;
                }
            });
        })
        $("#6").click(function (  ) {
            let left = $(".card").length-1;
            while(left>0){
                $("#card"+left).remove();
                left--;
            }
            let stat = $.getJSON('http://localhost:8090/blogweb_war/post/getByCategory',
                {
                    c_id: "6"
                }).done(function (data) {
                // data已经被解析为JSON对象了

                console.log(data);
                let val1 = data.length;
                console.log(val1);
                let t = 1;
                while (t <= val1) {
                    $("#card0").clone().attr("id", "card" + data[t - 1].id).appendTo(".card-columns").show();
                    $("#card" + data[t - 1].id).children("img").attr("src", "http://localhost:88/upload/" + data[t - 1].img);
                    $("#card" + data[t - 1].id).children("div").children("h2").text(data[t - 1].title);
                    $("#card" + data[t - 1].id).children("div").children("div").children("a").attr("href","post.html?p_id="+data[t - 1].id);
                    t += 1;
                }
            });
        })
        $("#5").click(function (  ) {
            let left = $(".card").length-1;
            while(left>0){
                $("#card"+left).remove();
                left--;
            }
            let stat = $.getJSON('http://localhost:8090/blogweb_war/post/getByCategory',
                {
                    c_id: "5"
                }).done(function (data) {
                // data已经被解析为JSON对象了

                console.log(data);
                let val1 = data.length;
                console.log(val1);
                let t = 1;
                while (t <= val1) {
                    $("#card0").clone().attr("id", "card" + data[t - 1].id).appendTo(".card-columns").show();
                    $("#card" + data[t - 1].id).children("img").attr("src", "http://localhost:88/upload/" + data[t - 1].img);
                    $("#card" + data[t - 1].id).children("div").children("h2").text(data[t - 1].title);
                    $("#card" + data[t - 1].id).children("div").children("div").children("a").attr("href","post.html?p_id="+data[t - 1].id);
                    t += 1;
                }
            });
        })
        $("#4").click(function (  ) {
            let left = $(".card").length-1;
            while(left>0){
                $("#card"+left).remove();
                left--;
            }
            let stat = $.getJSON('http://localhost:8090/blogweb_war/post/getByCategory',
                {
                    c_id: "4"
                }).done(function (data) {
                // data已经被解析为JSON对象了

                console.log(data);
                let val1 = data.length;
                console.log(val1);
                let t = 1;
                while (t <= val1) {
                    $("#card0").clone().attr("id", "card" + data[t - 1].id).appendTo(".card-columns").show();
                    $("#card" + data[t - 1].id).children("img").attr("src", "http://localhost:88/upload/" + data[t - 1].img);
                    $("#card" + data[t - 1].id).children("div").children("h2").text(data[t - 1].title);
                    $("#card" + data[t - 1].id).children("div").children("div").children("a").attr("href","post.html?p_id="+data[t - 1].id);
                    t += 1;
                }
            });
        })
        $("#3").click(function (  ) {
            let left = $(".card").length-1;
            while(left>0){
                $("#card"+left).remove();
                left--;
            }
            let stat = $.getJSON('http://localhost:8090/blogweb_war/post/getByCategory',
                {
                    c_id: "3"
                }).done(function (data) {
                // data已经被解析为JSON对象了

                console.log(data);
                let val1 = data.length;
                console.log(val1);
                let t = 1;
                while (t <= val1) {
                    $("#card0").clone().attr("id", "card" + data[t - 1].id).appendTo(".card-columns").show();
                    $("#card" + data[t - 1].id).children("img").attr("src", "http://localhost:88/upload/" + data[t - 1].img);
                    $("#card" + data[t - 1].id).children("div").children("h2").text(data[t - 1].title);
                    $("#card" + data[t - 1].id).children("div").children("div").children("a").attr("href","post.html?p_id="+data[t - 1].id);
                    t += 1;
                }
            });
        })
        $("#2").click(function (  ) {
            let left = $(".card").length-1;
            while(left>0){
                $("#card"+left).remove();
                left--;
            }
            let stat = $.getJSON('http://localhost:8090/blogweb_war/post/getByCategory',
                {
                    c_id: "2"
                }).done(function (data) {
                // data已经被解析为JSON对象了

                console.log(data);
                let val1 = data.length;
                console.log(val1);
                let t = 1;
                while (t <= val1) {
                    $("#card0").clone().attr("id", "card" + data[t - 1].id).appendTo(".card-columns").show();
                    $("#card" + data[t - 1].id).children("img").attr("src", "http://localhost:88/upload/" + data[t - 1].img);
                    $("#card" + data[t - 1].id).children("div").children("h2").text(data[t - 1].title);
                    $("#card" + data[t - 1].id).children("div").children("div").children("a").attr("href","post.html?p_id="+data[t - 1].id);
                    t += 1;
                }
            });
        })
        $("#1").click(function (  ) {
            let left = $(".card").length-1;
            while(left>0){
                $("#card"+left).remove();
                left--;
            }
            let stat = $.getJSON('http://localhost:8090/blogweb_war/post/getByCategory',
                {
                    c_id: "1"
                }).done(function (data) {
                // data已经被解析为JSON对象了

                console.log(data);
                let val1 = data.length;
                console.log(val1);
                let t = 1;
                while (t <= val1) {
                    $("#card0").clone().attr("id", "card" + data[t - 1].id).appendTo(".card-columns").show();
                    $("#card" + data[t - 1].id).children("img").attr("src", "http://localhost:88/upload/" + data[t - 1].img);
                    $("#card" + data[t - 1].id).children("div").children("h2").text(data[t - 1].title);
                    $("#card" + data[t - 1].id).children("div").children("div").children("a").attr("href","post.html?p_id="+data[t - 1].id);
                    t += 1;
                }
            });
        })


    });
</script>
<footer class="footer pt-5 pb-5 text-center">

</footer>
</body>

</html>
