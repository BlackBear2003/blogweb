<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>内容</title>
    <script type="text/javascript"> (function() { var css = document.createElement('link'); css.href = 'https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css'; css.rel = 'stylesheet'; css.type = 'text/css'; document.getElementsByTagName('head')[0].appendChild(css); })(); </script>
    <link rel="stylesheet" href="assets/css/app.css">
    <link rel="stylesheet" href="assets/css/theme.css">

</head>

<body>

<nav class="navbar navbar-expand-lg navbar-light bg-white fixed-top">
	<a id="logo" class="navbar-brand font-weight-bolder mr-3">
		<img src="assets/img/Hops/Hops.png">
		<img id="hops" src="assets/img/Hops/Hops_Stage_2.png" width="30">
		<img src="assets/img/Hops/Hops_Stage_3.png" width="30">
		<img src="assets/img/Cat.gif" width="60">
		<img src="assets/img/Hops/Hops_Stage_4.png" width="30">
		<img src="assets/img/Hops/Hops_Stage_5.png" width="30">
		<img src="assets/img/Hops/Hops_Stage_6.png" width="30">
	</a>
	<button class="navbar-light navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsDefault"
			aria-controls="navbarsDefault" aria-expanded="false" aria-label="Toggle navigation">
		<span class="navbar-toggler-icon"></span>
	</button>
	<div class="collapse navbar-collapse" id="navbarsDefault">

		<ul class="navbar-nav ml-auto align-items-center">
			<li class="nav-item">
				<a id="toHome" class="nav-link active">主页</a>
			</li>
			<li class="nav-item">
				<a id="post-btn" type="button" class="nav-link" data-toggle="modal" data-target="#postModal">发表</a>
			</li>
			<li class="nav-item">

				<a id="toProfile" class="nav-link" ><img id="userImg" class="rounded-circle mr-2" src="assets/img/av.png"
														 width="30"><span class="align-middle">个人主页</span></a>
				<!--上面是头像-->
			</li>
			<li class="nav-item dropdown">
				<a class="nav-link" href="#" id="dropdown02" data-toggle="dropdown" aria-haspopup="true"
				   aria-expanded="false">
					<svg style="margin-top:10px;" class="_3DJPT" version="1.1" viewbox="0 0 32 32" width="21"
						 height="21" aria-hidden="false" data-reactid="71">
						<path d="M7 15.5c0 1.9-1.6 3.5-3.5 3.5s-3.5-1.6-3.5-3.5 1.6-3.5 3.5-3.5 3.5 1.6 3.5 3.5zm21.5-3.5c-1.9 0-3.5 1.6-3.5 3.5s1.6 3.5 3.5 3.5 3.5-1.6 3.5-3.5-1.6-3.5-3.5-3.5zm-12.5 0c-1.9 0-3.5 1.6-3.5 3.5s1.6 3.5 3.5 3.5 3.5-1.6 3.5-3.5-1.6-3.5-3.5-3.5z"
							  data-reactid="22"></path>
					</svg>
				</a>
				<div class="dropdown-menu dropdown-menu-right shadow-lg" aria-labelledby="dropdown02">
					<h4 class="dropdown-header display-4">分享我的源代码!<br/> Zhile·Wei from FZU</h4>
					<div class="dropdown-divider">
					</div>
					<span class="dropdown-item"><a href="https://github.com/BlackBear2003/blogweb" class="btn btn-cyan d-block"><i
							class="fa fa-download"></i> Download</a></span><!--把我的github仓库放进去-->
				</div>
			</li>
		</ul>
	</div>
</nav>
<div class="modal fade" id="postModal">
	<div class="modal-dialog modal-lg">
		<div class="modal-content">
			<!-- 模态框头部 -->
			<div class="modal-header">
				<div class="input-group-prepend">
					<button id="selectCate" type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown">
						选择分类
					</button>
					<div class="dropdown-menu">
						<div class = "d-flex flex-column">
							<input id="category1" class="nav-link" type="button" value="风景">
							<input id="category2" class="nav-link" type="button" value="美食">
							<input id="category3" class="nav-link" type="button" value="游戏">
							<input id="category4" class="nav-link" type="button" value="旅行">
							<input id="category5" class="nav-link" type="button" value="居家">
							<input id="category6" class="nav-link" type="button" value="娱乐">
							<input id="category7" class="nav-link" type="button" value="书画">
						</div>
					</div>
				</div>
			</div>

			<!-- 模态框主体 -->
			<div class="modal-body">
				<input type="text" class="form-control bg-gaslight border-0 font-weight-bold mb-2 mr-2" id="title-input"
					   placeholder="输入标题" autocomplete="off">
				<input type="text" class="form-control bg-gaslight border-0 font-weight-bold mb-2 mr-2" id="text-input"
					   placeholder="输入正文" autocomplete="off">
				<input id="img_input" type="file" accept="image/*"/>
				<label for="img_input" id="img_label">选择一张图片
					<i class="fa fa-plus fa-lg"></i>
				</label>
				<div class="preview_box"></div>

			</div>

			<!-- 模态框底部 -->
			<div class="modal-footer">
				<div id="postConfirm" class="m-auto">
					<button class="btn btn-primary" type="button" value="发表">发表<i class="fa fa-check"></i></button>
				</div>
				<button type="button" class="btn btn-secondary" data-dismiss="modal">关闭

				</button>
			</div>

		</div>
	</div>
</div>
    
    <section class="bg-gray200 pt-5 pb-5">
    <div class="container">
    	<div class="row justify-content-center">
    		<div class="col-md-7">
    			<article class="card">
    			<img id="mainCardImg" class="card-img-top mb-2" src="https://images.unsplash.com/photo-1490645935967-10de6ba17061?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=e0245bb4e87077312cc3d102e68c1efd&auto=format&fit=crop&w=735&q=80" alt="Card image">
    			<div class="card-body">
					<img id="posterImg" src="assets/img/av.png" class="mt-neg100 mb-4 rounded-circle" width="100">
    				<h1 id="mainCardTitle" class="card-title display-4">
    				标题title </h1>
    				<div>
						<h5 id="mainCardText" class=".text-justify">
							text内容 text内容 text内容 text内容 text内容 text内容 text内容 text内容 text内容
							text内容 text内容 text内容 text内容 text内容 text内容 text内容 text内容 text内容
							text内容 text内容 text内容 text内容 text内容 text内容 text内容
						</h5>
					</div>
    				<small class="d-block">
						<a id="thumb-btn" class="btn btn-sm btn-gray200"><i class="fa fa-thumbs-up"></i></a>

					</small>
    				<!-- Begin Comments -replace demowebsite with your own id

    				<div id="comments" class="mt-4">
    					<div id="disqus_thread">
    					</div>
    					<script type="text/javascript">
                            var disqus_shortname = 'demowebsite'; 
                            var disqus_developer = 0;
                            (function() {
                                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                                dsq.src = window.location.protocol + '//' + disqus_shortname + '.disqus.com/embed.js';
                                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                            })();
                        </script>
    					<noscript>
    					Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a>
    					</noscript>
    				</div>

                    ================================================== -->
    			</div>
    			</article>
    		</div>
    	</div>
    </div>
    <div class="container-fluid mt-5">
    	<div class="row">
    		<h5 class="font-weight-bold">More like this</h5>
    		<div class="card-columns">
    			<div id="card0" class="card card-pin">
    				<img class="card-img" src="https://images.unsplash.com/photo-1518707399486-6d702a84ff00?ixlib=rb-0.3.5&ixid=eyJhcHBfaWQiOjEyMDd9&s=b5bb16fa7eaed1a1ed47614488f7588d&auto=format&fit=crop&w=500&q=60" alt="Card image">
    				<div class="overlay">
    					<h2 class="card-title title">Some Title</h2>
    					<div class="more">
    						<a href="post.html">
    						<i class="fa fa-arrow-circle-o-right" aria-hidden="true"></i> More </a>
    					</div>
    				</div>
    			</div>

    		</div>
    	</div>
    </div>
    </section>
        
    </main>

    <script src="assets/js/app.js"></script>
    <script src="assets/js/theme.js"></script>
    
    <footer class="footer pt-5 pb-5 text-center">
        
    <div class="container">
        
          <div class="socials-media">
    
            <ul class="list-unstyled">
              <li class="d-inline-block ml-1 mr-1"><a href="#" class="text-dark"><i class="fa fa-qq"></i></a></li>
              <li class="d-inline-block ml-1 mr-1"><a href="#" class="text-dark"><i class="fa fa-wechat"></i></a></li>
            </ul>
    
          </div>
        
            <!--
              All the links in the footer should remain intact.
              You may remove the links only if you donate:
              https://www.wowthemes.net/freebies-license/
            -->
    
        </div>
        
    </footer>    
</body>
<script>
	$("#card0").hide();
	$(document).ready(function () {

		let p_id =decodeURI(document.URL);
		p_id=p_id.slice(p_id.indexOf("=")+1);

		//帖子主要信息显示
		$.get("/blogweb_war/post?p_id="+p_id,function (data) {
			$("#mainCardText").text(data.text);
			$("#mainCardTitle").text(data.title);
			$("#mainCardImg").attr("src","http://"+window.location.hostname+":80/upload/" + data.img);
			$.get("/blogweb_war/post/getPoster?p_id="+p_id,function (u_id) {
				$.get("/blogweb_war/user/info?id="+u_id,function (data) {
					$("#posterImg").attr("src","http://"+window.location.hostname+":80/upload/" + data.img);
				})
			})
		})




		//test Session
		const loginId = sessionStorage.getItem("loginID");
		//console.log("session has loginID = " + loginId)

		//完成登陆后主界面个人信息的展示
		console.log(loginId);
		if (loginId) {
			$.get("/blogweb_war/user/info?id=" + loginId, function (data) {
				$("#hellotitle").text(data.name + ",你好！");
				$("#userImg").attr("src", "http://"+window.location.hostname+":80/upload/" + data.img);
			})
		}

		//打开个人信息时传输id（已登录状态）
		$("#toProfile").click(function () {
			if (loginId) {
				window.location.href = "profile.html?id=" + loginId;
			} else {
				window.location.href = "profile.html"
			}
		})
		$("#toHome").click(function () {
			if (loginId) {
				window.location.href = "index.html?id=" + loginId;
			} else {
				window.location.href = "index.html"
			}
		})
		//类似刷新
		$("#logo").click(function () {
			if (loginId) {
				window.location.href = "index.html?id=" + loginId;
			} else {
				window.location.href = "index.html"
			}
		})
		//发表帖子功能

		$("#post-btn").click(function () {
			if(loginId==null){
				window.location.href = "login.html"
				alert("您还未登录！")
			}
		})

		//检测是否支持File API
		if (window.File && window.FileReader && window.FileList && window.Blob) {
			//  支持
		} else {
			alert('不支持File API');
		}
		$("#img_input").on("change", function (e) {

			var file = e.target.files[0]; //获取图片资源

			// 只选择图片文件
			if (!file.type.match('image.*')) {
				return false;
			}

			var reader = new FileReader();

			reader.readAsDataURL(file); // 读取文件
			// 渲染文件
			reader.onload = function (arg) {
				var img = '<img class="preview" src="' + arg.target.result + '" alt="preview"/>';
				$(".preview_box").empty().append(img);
			}
		});
		let postCate = 0;
		$("#category1").click(function () {
			$("#selectCate").text($("#category1").val());
			postCate = 1;
		})
		$("#category2").click(function () {
			$("#selectCate").text($("#category2").val());
			postCate = 2;

		})
		$("#category3").click(function () {
			$("#selectCate").text($("#category3").val());
			postCate = 3;
		})
		$("#category4").click(function () {
			$("#selectCate").text($("#category4").val());
			postCate = 4;
		})
		$("#category5").click(function () {
			$("#selectCate").text($("#category5").val());
			postCate = 5;
		})
		$("#category6").click(function () {
			$("#selectCate").text($("#category6").val());
			postCate = 6;
		})
		$("#category7").click(function () {
			$("#selectCate").text($("#category7").val());
			postCate = 7;
		})


		$("#postConfirm").click(function () {
			var form_data = new FormData();
			var file_data = $("#img_input").prop("files")[0];
			let title = $("#title-input").val();
			let text = $("#text-input").val();
			//console.log(title);
			//console.log(text);
			form_data.append("file", file_data);
			//console.log(file_data);
			$.ajax({
				type: 'post',
				url: "/blogweb_war/fileUpload",
				data: form_data,
				cache: false,
				processData: false,
				contentType: false,
			}).success(function (imgName) {
				//alert(imgName);
				//console.log(imgName)

				$.post("/blogweb_war/post",
						{
							title: title,
							img: imgName,
							text: text
						}, function (data) {

							//console.log(data);
							$.post("/blogweb_war/post/setAuthor",
									{
										u_id: loginId,
										p_id: data
									}, function (status) {
										//alert("setAuthor:" + status);
									}
							)
							//console.log(postCate)
							$.post("/blogweb_war/post/setCategory",
									{
										c_id: postCate,
										p_id: data
									}, function (status) {
										//alert("setCategory:" + status);
										location.reload()
									}
							)

						})


				alert("发表成功！");

			})
		}).error(function () {
			alert("上传失败");
		});


		//点赞功能
		//检测是否点过

		//
		$.get("/blogweb_war/post/thumb?id="+p_id,function (data) {
			$("#thumb-btn").html("<i class=\"fa fa-thumbs-up\"></i>"+data)
		})

		//TODO:
		if(0){
			$("#thumb-btn").click(alert("您已经点过赞啦！"));
		}else{
			$("#thumb-btn").click(function () {
				$.post("/blogweb_war/post/thumb",
						{
							u_id:loginId,
							p_id:p_id
						},
						function (data) {
							alert("thumbed "+data);
						}
				)
			})
		}









	});
</script>



</html>
